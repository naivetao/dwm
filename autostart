#!/bin/sh
_thisdir=$(cd $(dirname $0); pwd)

_ifname=wlan0

statusbar() {
  bat=$(cat /sys/class/power_supply/BATT/capacity)
  free_mem=$(awk '/MemFree/ { printf "%.2f\n", $2/1024/1024 }' /proc/meminfo)
  avg_load=$(awk '{print $1}' /proc/loadavg)
  ip4=$(ip -4 -br addr show ${_ifname} |  grep -o -E "(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)")
  free_disk=$(df -h / | grep dev | cut -f 8 -d\ )

  xsetroot -name " $(date '+%H:%M')   $ip4   ${free_mem}G   $avg_load   $free_disk   $bat%"
}

cron() {
  i=0
  while true
  do
    [ $((i % 2)) -eq 0 ] && statusbar
    [ $((i % 600)) -eq 0 ] && feh --randomize --bg-fill $wallpapers/*.png

    sleep 2; i=$((i + 2))
  done
}

startup() {
  [ $1 ] && sleep $1
  st -e tmux &
}

daemons() {
  [ $1 ] && sleep $1
  xbanish -m ne&
  # dunst &
  fcitx5 -d 2> /dev/null &
  lf -server &
  picom -b
}

startup &
daemons &
cron &
